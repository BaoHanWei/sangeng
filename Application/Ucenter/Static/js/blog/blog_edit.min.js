$(function () {
	 $('.abstract').click(function () {
	        $(this).css("height","180px");
	        $(".edit-fixed").addClass("edit-flex-header");
	   });
	 $('.abstract').blur(function () {
		 $(this).css("height","28px");
		 $(".edit-fixed").removeClass("edit-flex-header");
	 });
	 $("#search").click(function(){
		 $(".search").addClass("focus");
		 $(".focus").css("width","330px");
	 })
	 $('#search').blur(function () {
		 $(".search").removeClass("focus");
		 $(".search").css("width","120px");
	 });
	 /*写博客里的分类添加*/
	 $('.input-add-sort').keydown(function(e){
		 if(e.keyCode==13){
			 var title=$(".input-add-sort").val();
			 $.post(U('Ucenter/Blog/add_blog_catalog'), {title: title}, function (msg) {
                if (msg.status) {
                    toast.success('操作成功！');
                    var string="<div class='select-opt active' data-value="+msg.data.id+"><span class='opt-name over-hide'>"+msg.data.title+"</span><span class='close drop'>×</span></div>";
                    $(".sort-items").append(string);
                    $("#self_catalog").val(msg.data.id);
                    $("#current_category").html(msg.data.title);
                    $("#current_category").attr("data-value",msg.data.id);
                } else {
                    handleAjax(msg);
                }
            }, 'json');
		 }
	});
	 $(".add_blog_catalog").click(function(){
		 var title=$("#txt_link_name").val();
		 var sort =$(".catalog_sort").val();
		 $.post(U('Ucenter/Blog/add_blog_catalog'), {title:title,sort:sort}, function (msg) {
             if (msg.status) {
                 toast.success('操作成功！');
                 window.location.reload();
             } else {
                 handleAjax(msg);
             }
         }, 'json');
	 });
	 $(".del_blog_catalog").click(function(){
		 var id=$(this).attr("data-value");
		 $.post(U('Ucenter/Blog/del_blog_catalog'), {id: id}, function (msg) {
             if (msg.status) {
                 toast.success('操作成功！');
                 window.location.reload();
             } else {
                 handleAjax(msg);
             }
         }, 'json');
	 });
	 $(".edit_blog_catalogs").click(function(){
		 var title=$("#txt_link_name").val();
		 var sort =$(".catalog_sort").val();
		 var id=$(".catalog_id").val();
		 $.post(U('Ucenter/Blog/edit_blog_catalog'), {title:title,sort:sort,id:id}, function (msg) {
             if (msg.status) {
                 toast.success('操作成功！');
                 window.location.reload();
             } else {
                 handleAjax(msg);
             }
         }, 'json');
	 });
	 $(".self-select-opt").click(function(){
		 var catalog=$(this).attr("data-value");;
		 var catalog_name=$(this).children().html();
		 $("#current_category").html(catalog_name);
		 $("#self_catalog").val(catalog)
		 $(this).addClass("active").siblings().removeClass("active");
	 });
	 $(".sys-select-opt").click(function(){
		 var catalog=$(this).attr("data-value");;
		 var catalog_name=$(this).html();
		 $(".sys_category").html(catalog_name);
		 $("#sys_sort").val(catalog)
		 $(this).addClass("active").siblings().removeClass("active");
		 if($(".edit-sys-sort").hasClass("error")==true){
			 $(".edit-sys-sort").removeClass("error")
		 }
		 var title=$("#title").val();
		 var self_sort=$("#self_sort").val();
		 var editormd_textarea=$(".editormd-html-textarea").val();
		 if(title!=''&&self_sort!=''&&editormd_textarea!=''){
			 $(".btn-save").removeClass("btn-disabled");
			 $(".stash-draft").removeClass("btn-disabled");
		 }else{
			 if($(".btn-save").hasClass("btn-disabled")==false){
				 $(".btn-save").addClass("btn-disabled");
			 }
			 if($(".stash-draft").hasClass("btn-disabled")==false){
				 $(".stash-draft").addClass("btn-disabled");
			 }
		 }
	 });
	 $(".offon").click(function(){
		 if($(this).hasClass("active")){
			 $(this).removeClass("active");
			 var for_name=$(this).attr("for");
			 $("#"+for_name).val(0);
			 if(for_name=='isStickTop'){
				 if(!$(this).parent().parent().next().hasClass("hide")){
					 $(this).parent().parent().next().addClass("hide");
				 }
			 }
		 }else{
			 $(this).addClass("active");
			 var for_name=$(this).attr("for");
			 $("#"+for_name).val(1);
			 if(for_name=='isStickTop'){
				 if($(this).parent().parent().next().hasClass("hide")){
					 $(this).parent().parent().next().removeClass("hide");
				 }
			 }
		 }
	 })
	 /*编辑器校验*/
	 $("#title").blur(function(){
		 var title=$("#title").val();
		 var self_sort=$("#self_sort").val();
		 var editormd_textarea=$(".editormd-html-textarea").val();
		 if(title!=''&&self_sort!=''&&editormd_textarea!=''){
			 $(".btn-save").removeClass("btn-disabled");
			 $(".stash-draft").removeClass("btn-disabled");
		 }else{
			 if($(".btn-save").hasClass("btn-disabled")==false){
				 $(".btn-save").addClass("btn-disabled");
			 }
			 if($(".stash-draft").hasClass("btn-disabled")==false){
				 $(".stash-draft").addClass("btn-disabled");
			 }
		 }
	 });
	 $("#description").blur(function(){
		 var title=$("#title").val();
		 var self_sort=$("#self_sort").val();
		 var editormd_textarea=$(".editormd-html-textarea").val();
		 if(title!=''&&self_sort!=''&&editormd_textarea!=''){
			 $(".btn-save").removeClass("btn-disabled");
			 $(".stash-draft").removeClass("btn-disabled");
		 }else{
			 if($(".btn-save").hasClass("btn-disabled")==false){
				 $(".btn-save").addClass("btn-disabled");
			 }
			 if($(".stash-draft").hasClass("btn-disabled")==false){
				 $(".stash-draft").addClass("btn-disabled");
			 }
		 }
	 });
	 $(".radio").click(function(){
		 var blog_type=$(this).attr("for");
		 if(blog_type=='isOriginal'){
			 $("#isOriginal").val("1");
			 $("#isOriginal").attr("checked","true");
			 $("#notOriginal").attr("checked","false");
		 }
		 if(blog_type=='notOriginal'){
			 $("#notOriginal").val("2");
			 $("#notOriginal").attr("checked","true");
			 $("#isOriginal").attr("checked","false");
		 }
	 });
	 $(".btn-save").click(function(){
		 var title=$("#title").val();
		 if(title==""||title==undefined||title==null){
			 toast.warning('博客标题不能为空');
			 return false;
		 }
		 var self_sort=$("#self_catalog").val();
		 if(self_sort==""||self_sort==undefined||self_sort==null){
			 toast.warning('博客分类不能为空');
			 return false;
		 }
		 var editormd_textarea=$(".editormd-html-textarea").val();
		 if(editormd_textarea==""||editormd_textarea==undefined||editormd_textarea==null){
			 toast.warning('博客内容不能为空');
			 return false;
		 }
		 var sys_catalog=$("#sys_sort").val();
		 if(sys_catalog==""||sys_catalog==undefined||sys_catalog==0){
			 toast.warning('系统分类不能为空');
			 $(".edit-sys-sort").addClass("error");
			 return false;
		 }
		 var description=$("#description").val();
		 var template=$(".editormd-markdown-textarea").val();
		 var tags=$(".input-tags").val();
		 var blog_type=$("input:radio[name='type']:checked").val();
		 var origin_url=$(".ext-url").val();
		 var isPrivate=$("#isPrivate").val();
		 var isComment=$("#isComment").val();
		 var isStickTop=$("#isStickTop").val();
		 var isRecommend=$("#isRecommend").val();
		 var blog_id=$(".blog_id").val();
		 if(blog_id!='' && blog_id!=undefined){
			 var old_cid=$(".old_cid").val();
		 }else{
			 var old_cid='';
		 }
		 //发布文章开始
		 $.post(U('Ucenter/Blog/editBlog'),{title:title,cid:self_sort,description:description,category:sys_catalog,markdown_template:template,content:editormd_textarea,tags:tags,blog_type:blog_type,origin_url:origin_url,is_private:isPrivate,is_comment:isComment,is_top:isStickTop,is_recommend:isRecommend,id:blog_id,old_cid:old_cid},function (msg) {
		        if (msg.status) {
		        	toast.success('操作成功！');
		        	 window.location.href=msg.jump_url;
		        } else {
		            handleAjax(msg);
		        }
		    }, 'json');
	 });
	 //博客删除
	 $(".delete_blog").click(function(){
		 var blog_id=$(this).attr("bolg-id");
		 var cid=$(this).attr("cid");
		 if (confirm('确定删除该文章吗？')) {
			 $.post(U('Ucenter/Blog/delBlog'),{id:blog_id,cid:cid},function (msg) {
			        if (msg.status) {
			        	toast.success('操作成功！');
	                    setTimeout(function () {
	                        window.location.reload();
	                    }, 500);
			        } else {
			            handleAjax(msg);
			        }
			    }, 'json');
		 }
	 });
	 $(".icon-search-dark").click(function(){
		 var search=$("#search").val();
		 var domain = window.location.host
		 window.location.href="http://"+domain+"/ucenter/blog/index/type/search/search/"+search;
	});
	 
});
/*写博客里的分类删除*/
$(document).on("click", ".close", function () {
	var id=$(this).parent().attr("data-value");
	$.post(U('Ucenter/Blog/del_blog_catalog'), {id: id}, function (msg) {
        if (msg.status) {
            toast.success('操作成功！');
            $(".close").parent().remove();
            var first_item=$(".sort-items").children(":first").attr("data-value");
            $("#self_sort").val(first_item);
            var current_category=$(".sort-items").children(":first").children().html();
            $("#current_category").html(current_category);
            $("#current_category").attr("data-value",first_item);
        } else {
            handleAjax(msg);
        }
    }, 'json');
 });

